<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="promo">
        <div class="modal-wrap">
            <input class="modal-input" type="text" placeholder="промокод">
            <button class="modal-btn">Применить</button>
        </div>
    </div>

    <script>
        const promocodeArr = [
        {
        promocode: 'PROM10',
        gift: "Скидка 10%"
        },
        {
        promocode: 'PROM50',
        gift: "Скидка 50%"
        },
        {
        promocode: 'GIFT',
        gift: "Подарок в корзине"
        }
        ]

        const inputEl = document.querySelector('.modal-input');
        const buttonEl = document.querySelector('.modal-btn');
    

        // Вспомогательная функция для получения данных из куки
        function getCookie() {
            return document.cookie.split('; ').reduce((acc, item) => {
            const [name, value] = item.split('=')
            acc[decodeURIComponent(name)] = decodeURIComponent(value)
            return acc
            }, {})
        }

        //красим правильный промокод и создаем текст скидки
        function createPromoText(obj) {
            inputEl.style.color = 'green';

            const span = document.createElement('span');
            span.textContent = `Промокод применен. ${obj.gift}`;
            span.classList.add('promoText')
            span.style.color = 'green'
            document.querySelector('.modal-wrap').append(span)
        }

        //удаление промо текста
        function removePromoText() {
            if(document.querySelector('.promoText')) {
                    document.querySelector('.promoText').remove();
                    inputEl.style.color = 'initial';
                }
        }
        const cookie = getCookie()// Получение данных

        //Промокод после знака "=" в куках 
        const cookiePromoCode = document.cookie.slice(10);
        console.log(cookiePromoCode);
        //если куки есть, то отрисовываем инпут со значением из куки

        if (cookie) {
            inputEl.value = `${cookiePromoCode}`;
            //для отображеия промотекста ищем в массиве нужный объект
            const promocodeElem = promocodeArr.find(item => item.promocode == cookiePromoCode);
            createPromoText(promocodeElem);
        }

        buttonEl.addEventListener('click', () => {
            removePromoText();
            const inputCode = inputEl.value.toUpperCase();
            //ищем введенный промокод среди других объектов
            const findElement = promocodeArr.find(el => el.promocode == inputCode);

            if (findElement) {
                //если валидацию промокод прошел, добавляем в куки 
                document.cookie = `promocode=${findElement.promocode}`;
                createPromoText(findElement)
                return 
            } else {
                removePromoText()
            }
        })

        inputEl.onfocus = function() {
            inputEl.style.borderColor = 'rgb(143, 177, 250)'
        }

    </script>
    
</body>
</html>